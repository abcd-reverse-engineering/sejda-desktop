<%- include('partials/task-screen-before'); %>

<style>
  #pdf-canvas {
    margin-bottom: 0;
    padding-bottom: 220px;
  }

  .pdf-page-wrap {
    margin: 5px 15px;
  }

  .pdf-page-wrap:hover {
    background-color: #ededed;
  }

  .pdf-page-wrap.selected {
    background-color: initial;
  }

  .pdf-page-wrap.selected:hover {
    background-color: initial;
  }

  .cut-mark {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    height: 156px;
    margin-top: 45px;
    width: 30px;
    position: absolute;
    z-index: 2;
    cursor: pointer;
    margin-left: -15px;
  }

  .cut-mark .line {
    border-left: 2px dashed rgba(2, 130, 229, 0.2);
    width: 1px;
    height: 100%;
  }

  .cut-mark.hover .line,
  .cut-mark:hover .line {
    border-left-color: #0282e5;
  }

  .cut-mark.selected .line {
    border-left: 2px solid #0282e5;
  }

  .cut-mark .fal {
    display: none;
    background-color: rgba(255, 255, 255, 0.9);
    color: #0282e5;
    border-radius: 20px;
    padding: 5px;
    position: absolute;
  }

  .cut-mark.selected .fal {
    background-color: #0282e5;
    color: #FFF;
  }

  .cut-mark.hover .fal,
  .cut-mark:hover .fal,
  .cut-mark.selected .fal {
    display: inline-flex;
  }

  .tooltip.cut-mark-tooltip {
    z-index: 100 !important;
  }

  .cut-mark-tooltip.tooltip.left .tooltip-arrow {
    border-left-color: #0282e5;
  }

  .cut-mark-tooltip.tooltip .tooltip-inner {
    text-align: left;
    /* background-color: #FFF; */
    text-align-last: left;
    width: 300px;
    background-color: #0282e5;
  }

  .cut-mark-tooltip .close {
    color: #FFF;
    opacity: 1;
    font-weight: 100;
    font-size: 20px;
  }

  .cut-mark-tooltip .tooltip-inner input[type=text] {
    font-size: 12px;
    padding: 0 4px;
    height: 28px;
    margin-top: 5px;
    color: #000;
  }

  .pdf-page-wrap .pdf-page-number {
    opacity: 1;
  }

  ul#filenamesTable {
    margin: 0;
    margin: auto;
    margin-top: 10px;
    padding: 0;
    text-align: left;
    max-height: 111px;
    overflow-y: scroll;
    -ms-overflow-style: none;
    scrollbar-width: none;
    max-width: 450px;
  }

  #filenamesTable li i {
    color: red;
    margin-right: 8px;
    font-size: 14px;
    opacity: 0.5;
  }

  #filenamesTable li .filename {
    font-size: 16px;
    max-width: min(320px, 75vw);
    text-overflow: ellipsis;
    overflow: hidden;
    display: inline-block;
    white-space: nowrap;
    vertical-align: middle;
  }

  #filenamesTable li .basename {
    cursor: pointer;
    color: #000;
  }

  #filenamesTable li .basename:hover {
    background-color: lightyellow;
  }

  #filenamesTable li .extension {
    color: #999;
  }

  #filenamesTable li .pages {
    color: #999;
    float: right;
  }

  .bottom-fixed-slim {
    max-width: min(600px, 100vw);
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
    border-top: 1px #fdd8a1 solid;
    border-left: 1px #fdd8a1 solid;
    border-right: 1px #fdd8a1 solid;
    box-shadow: 10px -11px 24px -4px rgba(0,0,0,0.13);
  }

  .bottom-fixed-slim:after {
    content: "";
    width: 100vw;
    background-color: rgba(255,235,205,.97);
    height: 15px;
    /* border: 1px red solid; */
    display: block;
    /* margin: auto; */
    left: 0;
    position: fixed;
    bottom: 0;
  }

  #renameFileModal .modal-dialog {
    margin-top: calc(50vh - 100px);
  }
</style>

<style>
  /* desktop only */
  .common-options-output-multiple-files .more-options-item {
    width: 400px !important;
  }
</style>

<section id="task-content" data-task="splitByPages" data-multiple-files="pro"
         data-can-clear-selection="true" data-can-select="false" data-can-select-multiple="false" data-single-click-select-multiple="true">
  <div class="container centered">
    <div class="row">
      <h1><%= __('Split PDF by pages') %></h1>
      <h2><%= __('Split specific page ranges or extract every page into a separate document') %></h2>
    </div>
  </div>

  <%- include('partials/file-upload'); %>
  <%- include('partials/loading'); %>
  <%- include('partials/pdf-files-summary'); %>

  <div class="centered step2" style="display:none" id="step2Choices">
    <div class="row">
      <label><lift:locS>Choose an option</lift:locS></label>
    </div>
    <div class="row">
      <a class="btn btn-medium btn-secondary default btn-choice" data-choice="burst">
        <div class="icons"><i class="fal fa-file-pdf"></i><i class="fal fa-angle-right"></i><i class="fal fa-copy"></i></div>
        <div class="text">12 pages <i class="fal fa-angle-right"></i> 12 docs</div>
        <strong><lift:locS>Extract every page into a PDF</lift:locS> <i class="fal fa-arrow-right"></i></strong>
      </a>
      <a class="btn btn-medium btn-secondary btn-choice" data-choice="select-pages">
        <div class="icons">
          <i class="fal fa-file-pdf"></i><i class="fal fa-file-pdf" style="opacity: 0.2;"></i><i class="fal fa-file-pdf"></i>
        </div>
        <div class="text">Visually select pages</div>
        <strong><lift:locS>Select pages to split</lift:locS> <i class="fal fa-arrow-right"></i></strong>
      </a>
      <a class="btn btn-medium btn-secondary btn-choice" data-choice="every-x-pages">
        <div class="icons"><i class="fal fa-file-pdf"></i><i class="fal fa-angle-right"></i><i class="fal fa-copy"></i></div>
        <div class="text">12 pages <i class="fal fa-angle-right"></i> 6 docs x 2 pages</div>
        <strong><lift:locS>Split every X pages</lift:locS> <i class="fal fa-arrow-right"></i></strong>
      </a>
      <a class="btn btn-medium btn-secondary btn-choice" data-choice="every-even-page">
        <div class="icons"><i class="fal fa-file-pdf"></i><i class="fal fa-angle-right"></i><i class="fal fa-file"></i><i class="fal fa-copy"></i></div>
        <div class="text">12 pages <i class="fal fa-angle-right"></i> 7 docs: 1,2-3,4-5,etc.</div>
        <strong><lift:locS>Split every even page</lift:locS> <i class="fal fa-arrow-right"></i></strong>
      </a>
    </div>
    <div class="row head-space-xl" style="margin-top: 30px;">
      <button id="step2ChoicesContinueBtn" class="btn btn-default btn-medium"><lift:locS>Continue</lift:locS> <i class="fal fa-angle-right"></i></button>
    </div>
  </div>

  <section class="step3" style="display: none">
    <%- include('partials/pdf-page-thumbnails'); %>
  </section>

  <div class="centered bottom-fixed bottom-fixed-slim step3" style="display:none">
    <form class="form-inline task-form" autocomplete="off">
      <input type="hidden" name="type" value="splitByPages"/>
      <input type="hidden" name="pages" value=""/>

      <div class="container-fluid">
        <div class="choice_select-pages">
          <div id="filenamesTableWrap" class="row" style="margin-bottom: 20px;">
            <label><lift:locS>Filenames</lift:locS><span id="output_files_count"></span>:</label>
            <ul id="filenamesTable">
              <li title="Rename" class="template" style="display: none"><i class="fal fa-file-pdf"></i><span class="filename"><span class="basename"></span><span class="extension">.pdf</span></span><span class="pages"></span></li>
            </ul>
          </div>
        </div>
        <div id="everyXPagesWrap" style="display: none">
          <div class="row">
            <label class="light">
              <lift:locS>Split every</lift:locS> <input value="1" placeholder="" data-validator="positive-integer" class="form-control input-lg input-short"
                                                        type="text" name="step" id="splitStep"> <lift:locS>pages</lift:locS>
            </label>
            <span class="input-help">
                    <i class="fal fa-question-circle lift:locTooltip" data-toggle="tooltip" data-placement="top" data-html="true"
                       title="Get separate documents containing pages 1-5 then 6-10 and then 11-15 etc (using step of 5)"></i>
                  </span>
          </div>
        </div>

        <div class="more-options" style="display: none">
          <div id="specificPagesWrap" style="display: none; width: 400px; margin: auto;">
            <div class="row">
              <label><lift:locS>Selected pages</lift:locS></label>
              <div class="input-group">
                <input value="" min="1" placeholder="Example: 1-4,8-10,13,15-"
                       class="form-control input-lg thumbs-multiple-select" type="text" name="pages"
                       id="specificPages" data-validator="page-ranges">

                <div class="input-group-addon input-help">
                  <i class="fal fa-question-circle lift:locTooltip" data-toggle="tooltip" data-placement="top" data-html="true"
                     title="Enter page ranges like 1-4,8-10,13,15-. This generates 4 documents, containing pages 1-4, 8-10, 13 and 15-end."></i>
                </div>
              </div>
            </div>
          </div>

          <div class="checkbox" style="margin-top: 10px; margin-bottom: 10px">
            <label>
              <input type="checkbox" value="true" name="discardOutline" id="discardOutline">
              <lift:locS>Discard bookmarks</lift:locS>
            </label>
            <span class="input-help">
                    <i class="fal fa-question-circle lift:locTooltip" data-toggle="tooltip" data-placement="top" data-html="true"
                       title="Remove bookmarks and outline from the result."></i>
                  </span>
          </div>
        </div>
        <div class="row head-space-xl">
          <button id="splitPdfByPagesSubmitBtn" type="submit" class="btn btn-default btn-medium"><lift:locS>Split PDF by pages</lift:locS></button>
          <a class="btn btn-link btn-medium btn-more-options" href="javascript://"><lift:locS>More options</lift:locS></a>
        </div>
      </div>
    </form>
  </div>
  <div id="renameFileModal" class="modal app-modal" style="display: none">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <div class="modal-title"><lift:locS>Rename file</lift:locS></div>
        </div>
        <div class="modal-body">
          <input type="text" name="filename" class="form-control input-lg">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light btn-xs" data-dismiss="modal"><lift:locS>Cancel</lift:locS></button>
          <button type="button" class="btn btn-primary btn-xs rename-btn" data-dismiss="modal"><lift:locS>Rename</lift:locS></button>
        </div>
      </div>
    </div>
  </div>
</section>

<%- include('partials/task-common-output-options', { onlyDirectory: true, outputFilenamePattern: '[CURRENTPAGE]_[BASENAME]' }); %>
<%- include('partials/task-screen-after'); %>
