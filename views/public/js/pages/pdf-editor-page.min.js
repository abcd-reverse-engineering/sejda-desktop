const fillSignMode=window.location.pathname.indexOf("/sign-pdf")>=0;var hasUnsavedWork=!1;$(document).ready(function(){$(document).on("fileUploadDone",function(t,n){"task-file"!==n.scope&&(hasUnsavedWork=!0)}),$(document).on("taskProcessingCompleted",function(){hasUnsavedWork=!1}),$(document).on("click",".page-wrap",function(){hasUnsavedWork=!0}),window.addEventListener("beforeunload",function(t){hasUnsavedWork&&(t.returnValue=!1)})});var SystemFonts=function(){function t(){return window.sejdaContext.editor.getAvailableFonts()}const n={};var e=null;const o=n.getAvailableFonts=function(n){if(null!=e)return n(e);try{t().then(function(t){1!==t.length||t[0].postscriptName||(console.warn("Platform update for Windows 7 SP1 not installed? https://support.microsoft.com/en-us/kb/2670838"),t=[]),t=_.filter(t,function(t){var n=t.path.toLowerCase();return n.endsWith(".otc")&&console.log(t),n.endsWith(".ttf")||n.endsWith(".ttc")||n.endsWith(".otf")||n.endsWith(".otc")});var o=_.groupBy(t,function(t){return t.family}),a=_.keys(o);return a.sort(),e={families:a,byFamily:o},n(e)}).catch(function(t){return console.error("Failed to load system fonts",t),n({families:[],byFamily:{}})})}catch(t){return console.error("Failed to load system fonts",t),n({families:[],byFamily:{}})}};var a=new Dexie("pdf-editor-fonts");a.version(1).stores({systemFonts:"++id,name,jsonData"});const i=(n.populateFontsMenu=function(){o(function(t){t.families.forEach(function(t){Sejda.Fonts.addAvailableFont(t)})}),i(function(t){var n=$("#addMoreFontsBtn");n.parents("ul").find(".system-font").remove();var e=n.parents("li").next("li.divider");t.forEach(function(t){var n=$('<li class="system-font"><a href="javascript://"></a></li>'),o=n.find("a");o.css("font-family",'"'+t+'"').attr("data-font",t).text(t),n.insertBefore(e)}),t.length>0&&$('<li role="separator" class="divider system-font"></li>').insertAfter(n.parents("li"))})},n.getSelected=function(t){a.systemFonts.toArray(function(n){n=n||[];var e=n.map(function(t){return JSON.parse(t.jsonData)});t(e)})},n.getSelectedFamilies=function(t){a.systemFonts.toArray(function(n){n=n||[];var e=n.map(function(t){return t.name});t(e)})});n.saveSelected=function(t,n){a.systemFonts.clear().then(function(){o(function(e){var o=t.map(function(t){var n=e.byFamily[t];return{name:t,jsonData:JSON.stringify(n)}});a.systemFonts.bulkPut(o).then(n)})})};return n}();$(function(){try{SystemFonts.populateFontsMenu()}catch(t){console.error("Failed to populate fonts menu",t),Raven.captureException(t)}});var SystemFontsModal=function(){function t(){n.modal("show"),SystemFonts.getSelectedFamilies(function(t){SystemFonts.getAvailableFonts(function(n){var o=n.families;e.find("li").remove(),0===o.length&&e.append($('<div class="failure">Loading fonts failed. <a href="https://www.sejda.com/help#loading-local-fonts-failed">Troubleshooting help</a>.</div>')),o.forEach(function(n){var o=$('<li><div class="checkbox"><label><input type="checkbox" name="systemFont" value="'+n+'"/><span>'+n+"</span></label></div></li>");o.css({"font-family":n}).attr("data-family",n),t.indexOf(n)>=0&&o.find("input[type=checkbox]").prop("checked",!0),o.click(function(t){var n=$(t.target).prop("tagName");"INPUT"!==n&&"LABEL"!==n&&"SPAN"!==n&&o.find("input[type=checkbox]").click()}),e.append(o)})})})}var n=$("#systemFontsPrompt"),e=n.find("#systemFonts"),o=n.find("[name=systemFontSearch]");return o.keyup(function(){var t=o.val().toLowerCase();e.find("li").each(function(){var n=$(this);if(""===t)return void n.show();var e=n.attr("data-family");e&&(e.toLowerCase().indexOf(t)<0?n.hide():n.show())})}),n.find(".btn-dismiss").off("click").on("click",function(){n.modal("hide")}),n.find(".btn-ok").off("click").on("click",function(t){t.stopPropagation();var o=e.find("input[type=checkbox]:checked").map(function(){return this.value}).toArray();SystemFonts.saveSelected(o,function(){SystemFonts.populateFontsMenu(),n.modal("hide"),$("#text-editable-menu").find(".font-family-opts").siblings("button").click()})}),{show:t}}();$("#addMoreFontsBtn").off("click").on("click",function(t){t.stopPropagation(),SystemFontsModal.show()}),$(function(){function t(){$(".step2opt").fadeOut(100),$(".step3a").fadeIn(200,function(){$("#edit-pages-wrap").scrollHere(),$(document).trigger("renderVisiblePageThumbs")})}var n=window.location.pathname.indexOf("/sign-pdf")>=0;n&&$("#edit-pages").addClass("fill-sign-mode"),$(document).on("showStep2",function(){t()})}),$(function(){const t=window.sejdaContext.general.prefs;var n=t.get(),e=n.disabledFeatures||"";e.includes("edit.whiteout")&&(console.log("Feature edit.whiteout is disabled"),$("#tools-menu").find(".btn[data-tool=whiteout]").parent(".btn-group").remove())}),$(function(){$(document).on("keydown",function(t){if(80===t.keyCode&&(t.ctrlKey||t.metaKey))return t.preventDefault(),t.stopPropagation(),alert("To print this document please first save your changes, then click the 'Print' button on the next screen"),!1})});