$(function(){function e(e){return $(e.elm).attr("data-filename-raw").toLowerCase()}function t(e){return parseInt($(e.elm).attr("data-lastmod")||"0")}function n(e){$(".can-toggle-view-mode").find("input[name=mode][value="+e+"]").parents("label").click()}function a(){const e=s.find(".pdf-page-wrap").first().outerHeight()||r.find(".pdf-page-wrap").first().outerHeight(),t=$('<style id="addMarkHeightCss">.add-mark { height: '+e+"px; </style>");$("#addMarkHeightCss").remove(),$("body").append(t)}function o(){setTimeout(function(){$(document).trigger("renderVisiblePageThumbs")},500)}window.globalPdfRenderOpts={useLetterPrefix:!0},$(document).on("moreOptionsShown",function(){$("#taskOptionsPanel").removeClass("bottom-fixed").addClass("bottom-task-options")}),$(document).on("moreOptionsHidden",function(){$("#taskOptionsPanel").addClass("bottom-fixed").removeClass("bottom-task-options")});const d=$(".can-toggle-view-mode"),i=$(".btn-more-options"),s=$("#pdf-canvas-list"),r=$("#pdf-canvas-list2");d.show();var c="file";$("body").attr("data-view-mode","file"),s.hide(),r.show();var l=0;$(document).on("pdfPageRendered",function(t,n){if(1===n.pageNum){r.append(n.$elem.cloneWithCanvas());var a=!0;0===l?l=Date.now():Date.now()-l>4e3&&(a=!1),a&&tinysort("#pdf-canvas-list2>li",{order:"asc",sortFunction:function(t,n){return naturalSort(e(t),e(n))}})}}),$(document).on("pagesRendered",function(e,t){t.$elem[0].id===s[0].id&&($(document).trigger("pagesRendered",{files:t.files,$elem:r}),$(document).trigger("renderVisiblePageThumbs"))}),$(document).on("changedViewMode",function(e,t){c=t.mode,$(".task-form").find('input[name="mode"]').val(c),"page"===c?(s.show(),r.hide(),i.hide(),$(document).trigger("hideMoreOptions")):"file"===c&&(s.hide(),r.show(),i.show()),$(document).trigger("renderVisiblePageThumbs")});const p=$("#tools-menu");$(window).scroll(function(){const e=$(this).scrollTop();e<270?p.css({position:""}).removeClass("fixed"):p.css({position:"fixed",top:0}).addClass("fixed")});const f=$("#globalBtns");f.detach().appendTo(p).show(),$(".sort-btn").click(function(){var n="file"===c?"#pdf-canvas-list2>li":"#pdf-canvas-list>li";const a=$(this).attr("data-sort-order").split("-"),o=a[1];var d=function(t,n){return naturalSort(e(t),e(n))};"lastmod"===a[0]&&(d=function(e,n){const a=t(e),o=t(n);return a===o?0:a<o?-1:1}),tinysort(n,{order:o,sortFunction:d}),$(document).trigger("fileOrderChanged"),$(document).trigger("renderVisiblePageThumbs")}),$(document).on("click",".add-blank-page-btn",function(e){e.preventDefault(),n("page");const t=$(this).parents("[data-insert-at]").attr("data-insert-at"),a=Sejda.Utils.parseInsertAt(t,s);var o=a.page;if(o&&0!==o.length||(o=s.find(".pdf-page-wrap.selected:last"),0===o.length&&(o=s.find(".pdf-page-wrap:first"))),0===o.length)return void Raven.captureMessage("Could not determine where to insert blank page");const d=o.cloneWithCanvas();d.attr("data-filename","blank_page").attr("data-file-counter","-1").attr("data-page","-1"),d.find(".pdf-page-number").attr("title",s_i18n("New blank page")).text(""),d.removeClass("ui-sortable-handle selected ui-multisort-grouped"),d.attr("id","pdfPageWrap_Blank"+Date.now()),d.find(".magnified").remove(),d.find("img").remove(),d.clearCanvases(),a.insertAfter?d.insertAfter(o):d.insertBefore(o)});var u=0;$(".task-form");$(document).on("fileUploadStarted",function(e,t){u++,Sejda.UnsavedWork.markUnsavedWork()}),$(document).on("thumbSizeChanged",function(e,t){a()}),$(document).on("pdfPageRenderedLazy",function(e,t){1===t.pageNum&&a()});const m=$("#addMarkDropdownMenu");$("body").append(m.parent("section").detach()),$(document).on("click",function(e){m.hide()});const g=$("#addMoreFilesBtn"),h=$("#addMorePagesBtn");$(document).on("mouseover","#addMoreFilesBtn",function(){g.append($("#add-files-moving-menu").detach().css("display","")),m.hide()}),$(document).on("mouseover","#addMorePagesBtn",function(){h.append($("#add-pages-moving-menu").detach().css("display","")),m.hide()}),$(document).on("click",".add-mark .fal",function(e,t){const n=$(this),a=e.pageY-15;var o=e.pageX-10;const d=m.width(),i=window.innerWidth;m.find(".dropdown-submenu").removeClass("pulled-left"),o+2*d>i&&(m.find(".dropdown-submenu").addClass("pulled-left"),o+d>i&&(o=i-d-10)),m.find(".add-files-menu-item").append($("#add-files-moving-menu").detach()),m.find(".add-pages-menu-item").append($("#add-pages-moving-menu").detach());const s=n.parents(".add-mark"),r=[s.parents(".pdf-page-wrap").attr("id"),s.hasClass("before")?"before":"after"].join(":");return m.attr("data-insert-at",r),m.css({top:a+20,left:o+15}).show(),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),!1});const v=$("#pdf-canvas-wrap");$(document).on("pagesRendered",function(e,t){v.hide(),s.find(".pdf-page-wrap").each(function(){const e=$(this);if(!(e.find(".add-mark").length>0)){const t=$('<div class="add-mark"><i class="fal fa-plus-circle"></i></div>'),n=e.attr("id");t.attr({"data-parent":n,"data-page":e.attr("data-page")}).addClass("after"),t.insertAfter(e.find("canvas"));const a=t.clone();a.removeClass("after").addClass("before"),e.prepend(a)}}),v.show(),o()}),$(document).hoverIntent({interval:0,timeout:400,over:function(){const e=$(this);m.find(".dropdown-submenu .dropdown-menu").hide(),e.find(".dropdown-menu").show()},out:function(){const e=$(this);e.find(".dropdown-menu").hide()},selector:".dropdown-submenu"})});