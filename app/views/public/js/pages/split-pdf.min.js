$(function(){function t(){const t=c.find(".pdf-page-wrap:first").first(),e=t.outerHeight(),a=t.find("canvas").outerHeight(),n=Math.ceil((e-a)/2)+10,s=a-20,o=$('<style id="cutMarkHeightCss">.cut-mark { height: '+s+"px; margin-top: "+n+"px</style>");$("#cutMarkHeightCss").remove(),$("body").append(o)}function e(t){var e=t.attr("data-parent");$("#cutMark_"+e).tooltip("hide")}function a(){$(".cut-mark-tooltip").each(function(){e($(this))})}function n(){var t=1;const e=$("#pdf-canvas-list").find(".pdf-page-wrap");var a=0;const n=["group-b","group-c","group-d","group-e","group-a"],s=n.join(" ");e.removeClass(s);const o=e.filter(".selected");0!==o.length&&e.each(function(){var e=$(this);const s=n[a%n.length];e.addClass(s),t++;const o=e.next(".cut-mark");o.hasClass("selected")&&(t=1,a++)})}function s(){const t=$("[name=outputFilenamePattern]").val(),e=[],a=(new Date).toISOString().replaceAll(":","-").replaceAll("T","_").substring(0,19).replaceAll("-","");k.empty();var n=1;const s=$(".cut-mark");s.filter(".selected").each(function(){const s=$(this),i=s.attr("data-page"),c=e.length+1,l=s.attr("data-parent"),p=$("#"+l),u=p.attr("data-result-filename")||t.replaceAllEscapedCaseInsensitive("[BASENAME]",r).replaceAllEscapedCaseInsensitive("[CURRENTPAGE]",i).replaceAllEscapedCaseInsensitive("[FILENUMBER]",c).replaceAllEscapedCaseInsensitive("[TIMESTAMP]",a);e.push(u);const d=n===i?i:n+"-"+i,f=C.clone();f.find(".basename").text(u),f.find(".pages").text(d),f.attr("data-parent",l),f.tooltip(tooltipOpts),f.click(function(){const t=$('.cut-mark[data-page="'+i+'"]');o(t,f)}),k.append(f),n=Number.parseInt(i)+1}),$("#output_files_count").text(" ("+e.length+")")}function o(t,e){function a(){const t=n.val();o.attr("data-result-filename",t),e.find(".basename").text(t)}const n=b.find("input[name=filename]"),s=t.attr("data-parent"),o=$("#"+s);n.val(e.find(".basename").text()),n.off("keyup").on("keyup",function(t){if(13===t.keyCode)return b.find(".rename-btn").click(),t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),!1}),b.find(".rename-btn").off("click").on("click",a),b.modal("show"),n.each(function(){this.select()})}function i(){$(".step2").fadeOut(100),$(".step3").fadeIn(200),$("#pdf-canvas-wrap").fadeIn(200),$(document).trigger("renderVisiblePageThumbs")}const c=$("#pdf-canvas-list");var r;$(document).on("filesSelected",function(t,e){r||(r=parseFilename(e.files[0].name)[0])}),$(document).on("thumbSizeChanged",function(e,a){t()}),$(document).on("pdfPageRenderedLazy",function(e,a){1===a.pageNum&&t()}),$(document).on("click",".cut-mark",function(t){t.stopPropagation();const e=$(this);e.hasClass("last")||(e.toggleClass("selected"),e.hasClass("selected")?$(this).trigger("show-cutmark-tooltip"):a(),e.prev(".pdf-page-wrap").toggleClass("selected"),$(document).trigger("selectedPagesChanged"))}),$(document).on("mouseenter",".pdf-page-wrap",function(t){const e=$(this);e.prev(".cut-mark").addClass("hover"),e.next(".cut-mark").addClass("hover")}),$(document).on("mouseleave",".pdf-page-wrap",function(t){const e=$(this);e.prev(".cut-mark").removeClass("hover"),e.next(".cut-mark").removeClass("hover")}),$(document).on("show-cutmark-tooltip",".cut-mark",function(){a();var t=$(this),n=t.attr("data-parent");const s=Number.parseInt(t.prevAll(".cut-mark.selected").first().attr("data-page"))+1||1,o=t.attr("data-page"),i=s+"-"+o;t.tooltip({placement:"left",container:"body",trigger:"manual",html:!0,title:'<span class="close">&times;</span>Pages: <span style="opacity: 0.7">'+i+'</span><br/>Filename: <span style="opacity: 0.7">(optional)</span> <input type="text" name="result-filename-input" class="form-control input-xs result-filename-input" />',template:'<div data-parent="'+n+'" class="tooltip cut-mark-tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}),t.tooltip("show"),t.on("shown.bs.tooltip",function(a){var n=t.attr("aria-describedby"),s=t.attr("data-parent"),o=$("#"+s),i=$("#"+n).find("input");i.val(o.attr("data-result-filename")),i.each(function(){this.select()}),i.keyup(function(a){if(27===a.keyCode||13===a.keyCode)return e(t),a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),!1})})}),$(document).on("click",".cut-mark-tooltip .close",function(t){e($(this).parents(".tooltip"))}),$(document).on("select-none",function(){a()}),$(document).on("click",function(t){const e=$(t.target);0===e.parents(".cut-mark-tooltip").length&&a()}),$(document).on("input",".result-filename-input",function(t){const e=$(this).parents(".tooltip").attr("data-parent"),a=$("#"+e),n=$(this).val();a.attr("data-result-filename",n);const s=k.find('[data-parent="'+e+'"]');s.find(".basename").text(n)}),$("button[type=submit]").on("click",function(){a()}),$("#specificPages").keyup(function(){var t=$(this).val(),e=[];_.map(t.split(","),function(t){var a=t.split("-");a[0]=parseInt(a[0]),a[1]&&(a[1]=parseInt(a[1])),a[1]&&e.push(a[1]),1!=a[0]&&a[0]!=a[1]&&"undefined"!=typeof a[1]&&e.push(a[0]-1)}),$(document).trigger("selectedPagesChangedInput",{pages:e})});var l=0,p=$(".task-form"),u=$("#splitPdfByPagesSubmitBtn"),d=$("#splitStep"),f=p.find("input[name=pages]");d.keyup(function(){var t=parseInt(d.val());if(!isNaN(t)){const e=$(".cut-mark");e.removeClass("selected");const a=[];for(var n=t;n<=l;n+=t)a.push(n),e.filter('[data-page="'+n+'"]').addClass("selected");e.length>20&&(h=!0,v.hide()),$(document).trigger("selectedPagesChangedInput",{pages:a})}});var m=null;const g=new Promise(function(t,e){m=t});$(document).on("pagesRendered",function(){$("#pdf-canvas-wrap").hide();const t=c.find(".pdf-page-wrap");l=t.length,t.each(function(e){var n=$(this),s=$('<div class="cut-mark"><div class="line"></div><i class="fal fa-cut"></i></div>'),o=n.attr("id");s.attr({"data-parent":o,id:"cutMark_"+o,"data-page":n.attr("data-page")}),s.insertAfter(n),s.hoverIntent(function(){const t=$(this);a(),t.hasClass("selected")&&t.trigger("show-cutmark-tooltip")},function(){});const i=e===t.length-1;i&&s.addClass("selected last")}),n(),s(),m()});var h=!1;const v=$("#filenamesTableWrap"),k=$("#filenamesTable"),C=k.find("li.template").clone().removeClass("template").show(),b=$("#renameFileModal");$(document).on("selectedPagesChangedInput selectedPagesChanged",function(){n(),s()}),$(document).on("moreOptionsShown",function(){v.hide()}),$(document).on("moreOptionsHidden",function(){h||v.show()});var y=$("#step2Choices").find(".btn[data-choice]");$("#step2ChoicesContinueBtn").click(function(){y.first().click()});var w=null;y.click(function(){w=$(this).attr("data-choice"),d.val("").trigger("keyup"),f.val("all"),"burst"===w?(g.then(function(){console.log("Setting splitStep 1"),d.val(1).trigger("keyup")}),i()):"every-x-pages"===w?(g.then(function(){d.val(4).trigger("keyup")}),$("#everyXPagesWrap").show(),i()):"every-even-page"===w?(f.val("even"),u.click()):($("#specificPagesWrap").show(),$(".choice_select-pages").show(),i())}).mouseover(function(){y.removeClass("default")}).mouseout(function(){y.first().addClass("default")});var P=$(".btn-more-choice-options,.btn-more-choices-ellipsis");P.click(function(){P.fadeOut(100),$(".btn-choice").removeClass("hidden")}),$(".btn-more-choices-ellipsis").tooltip(tooltipOpts)});