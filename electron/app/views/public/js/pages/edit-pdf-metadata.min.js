$(function(){function e(e){var t=e.substr(2,4),a=e.substr(6,2),n=e.substr(8,2),o=e.substr(10,2),i=e.substr(12,2),r=e.substr(14,2),l="00",s="00";e.endsWith("Z")||"+"!==e.substr(16,1)||(l=e.substr(17,2),s=e.substr(20,2));var d=t+"-"+a+"-"+n+"T"+o+":"+i+":"+r+"+"+l+":"+s;return new Date(d)}function t(e,t,a){var n=c.find('[name="metadata.'+e+'"]');if(0===n.length){var o=u.clone();o.find("input[type=text]").attr("name","metadata."+e).val(t),o.find("label").text(e),a===!0&&o.removeClass("collapsed"),c.append(o)}else n.val(t)}function a(a,n){function o(o){$(".doc-loading").hide(),$(".page-loading").show(),o.getMetadata().then(function(a){if(a&&a.info){var o=[],i={};l.forEach(function(t){if(o.push(t),i[t]=a.info[t],s.includes(t)&&i[t]){var n=e(i[t]),r=n.toLocaleDateString("en-GB",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",hour12:!1,minute:"2-digit",second:"2-digit"}).replace("AM","").replace("PM","").trim();i[t]=r}}),o.sort(),"object"==typeof a.info.Custom&&Object.keys(a.info.Custom).forEach(function(e){o.push(e),i[e]=a.info.Custom[e]}),n===!0&&u.addClass("collapsed");for(var r=0;r<o.length;r++){var d=o[r],c=i[d];t(d,c)}["CreationDate","ModDate"].forEach(function(e){var t=$('[name="metadata.'+e+'"]');""===t.val()&&t.siblings(".hint").text("Example: 13/04/2021, 23:53:41")})}}).catch(function(e){console.error(e),Raven.captureException(e)}),o.getPermissions().then(function(e){const t=new PdfPerms;if(t.update(e,globalPdfJS),!t.isAllowedModify()){const n=d.find("button[type=submit]");n.disable();const o="true"===$("body").attr("data-pro-user");Analytics.trackEvent("perms",$("#task-content").attr("data-task"),o?"pro":"free",t.listDenied().join(":")),PdfFilesPwd.prompt({file:a,callback:function(){Analytics.trackNoPushEvent("perms","unlocked"),n.enable()},cancelCallback:function(){},isOwnerPwd:!0,permissions:[t.Modify]})}})}function i(){console.error("Failed loading document"),$(".doc-loading").hide(),$(".task-form").find("[type=submit]").attr("disabled","disabled")}PdfFiles.getDocument(a,o,i)}function n(e){var t=e.replace(/[^a-zA-Z0-9]/gi,"");return t===e}function o(){$(".step2").fadeOut(100),$(".step3").fadeIn(200)}function i(e){if(!e)return e;for(var t="",a=0;a<e.length;a++){const n=e.charCodeAt(a);r(n)&&(t+=String.fromCharCode(n))}return t}function r(e){return 9===e||10===e||13===e||e>=32&&e<=55295||e>=57344&&e<=65533||e>=65536&&e<=1114111}var l=["Title","Author","Subject","Creator","Keywords","CreationDate","ModDate","Producer"],s=["CreationDate","ModDate"],d=$(".task-form"),c=$("#metadataFieldsGroupWrap"),u=c.find(".form-group").first();$(document).on("click",".form-group-header",function(){var e=$(this);e.parents(".form-group").toggleClass("collapsed"),e.find(".icon-collapse").remove()});var f=!1;$(document).on("filesSelected",function(e,t){if(!f){f=!0;var n=t.files.length>1;a(t.files[0],n)}});var m=$("#newMetaFieldModal");$("#openNewMetaFieldModalBtn").click(function(){m.modal("show")}),$("#addNewMetaFieldBtn").click(function(){var e=$("#newMetaFieldName").val(),a=$("#newMetaFieldValue").val();return n(e)?0===e.trim().length||0===a.trim().length?alert("Name or value is blank"):(t(e,a,!0),void m.modal("hide")):alert("Field name can contain only alphanumeric characters (a-z, A-Z, 0-9) and no spaces")}),$(document).on("click",".delete-meta-field-btn",function(e){var t=$(this).parents(".form-group"),a=t.find("input"),n=a.attr("name").substring("metadata.".length);d.append('<input type="hidden" name="fieldsToRemove[]" value="'+n+'">'),t.remove()});var p=$("#step2Choices").find(".btn[data-choice]");$("#step2ChoicesContinueBtn").click(function(){p.first().click()}),p.click(function(){var e=$(this).attr("data-choice");"remove-all"===e?(d.find('[name="removeAllMetadata"]').val("true"),d.find('button[type="submit"]').click()):(d.find('[name="removeAllMetadata"]').val("false"),o())}).mouseover(function(){p.removeClass("default")}).mouseout(function(){p.first().addClass("default")}),$(document).on("change","#metadataFieldsGroupWrap input[type=text]",function(e){const t=$(this),a=t.val(),n=i(a);a!==n&&(t.val(n),Sejda.FormValidation.showTooltip(t,s_i18n("Invalid characters were removed")))})});