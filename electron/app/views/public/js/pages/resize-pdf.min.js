$(function(){function e(e){return e.charAt(0).toUpperCase()+e.slice(1)}function t(t){var a=$(".task-form").find("[name=margin"+e(t)+"]"),i=parseFloat(a.val().replace(",","."));return i||(i=0),i}function a(e){return parseFloat(Big(e).toFixed(2))}function i(e){var i=$(e),n=i.find(".pdf-page");if("true"===n.attr("data-rendered")){var o=Big(n.attr("data-scale")),s=Big(n.innerWidth()).div(parseFloat(n.attr("width"))),r=s.times(o);const d=Big(2.54),c=Big(r).times(72),p="inch"===l?c:c.div(d);var u=t("top"),g=t("left"),m=t("right"),f=t("bottom"),h=p.times(u),v=p.times(g),w=p.times(m),x=p.times(f);n.css("border-top",h.toFixed(2)+"px solid transparent"),n.css("border-left",v.toFixed(2)+"px solid transparent"),n.css("border-right",w.toFixed(2)+"px solid transparent"),n.css("border-bottom",x.toFixed(2)+"px solid transparent");var S=i.find(".pdf-page-size");0===S.length&&(S=$('<div class="pdf-page-size"></div>'),i.append(S));const b=Big(n.attr("data-v-width")).div(72),z=Big(n.attr("data-v-height")).div(72),B=b.times(d),F=z.times(d),C=a("inch"===l?b.toFixed(2):B.toFixed(2)),k=a("inch"===l?z.toFixed(2):F.toFixed(2)),P="inch"===l?"in":"cm";S.text(C+" x "+k+" "+P);var y=parseFloat($("input[name=pageSizeWidth]").val())||parseFloat(C),D=parseFloat($("input[name=pageSizeHeight]").val())||parseFloat(k);y=y+g+m,D=D+u+f,y=a(y),D=a(D);const M=y+" x "+D+" "+P;y==C&&D==k||(S.find(".pdf-page-size-new").remove(),$('<div class="pdf-page-size-new"></div>').text(M).insertBefore(S))}}function n(){var e=$(".pdf-page-wrap.selected");0===e.length&&(e=$(".pdf-page-wrap")),$(".pdf-page-wrap canvas").css("border","0"),$(".pdf-page-size-new").remove(),e.each(function(){i(this)})}function o(){try{n()}catch(e){console.error(e)}}function s(){var e=u.val();if("custom"===e?g.show():g.hide(),"auto"===e)return $("input[name=pageSizeWidth]").val("0.0"),void $("input[name=pageSizeHeight]").val("0.0").trigger("keyup");const t=(u.find('[value="'+e+'"]').attr("data-dims-"+l)||"").split("x"),a=t[0],i=t[1];a&&i&&($("input[name=pageSizeWidth]").val(a),$("input[name=pageSizeHeight]").val(i).trigger("keyup"))}function r(){setTimeout(s,100)}function d(){const e="inch"===l?"in":"cm";u.find("option[value]").each(function(){const t=$(this),a=t.text().split(" ")[0],i=(t.attr("data-dims-"+l)||"").split("x");2===i.length&&t.text([a," (",i[0]," x ",i[1]," ",e,")"].join(""))}),u.selectpicker("refresh")}function c(){$(".step2").fadeOut(100),$(".step3").fadeIn(200),m.fadeIn(200),$(document).trigger("renderVisiblePageThumbs")}function p(e,t){try{return!e||t<1||t>e.numPages?Promise.reject(new Error("Invalid PDF or page number")):e.getPage(t).then(function(e){const t=e.getViewport({scale:1});if(!t.rawDims||!t.rawDims.mediaBox||!t.rawDims.cropBox){const a=[0,0,t.width,t.height],i=t.viewBox[0]!==a[0]||t.viewBox[1]!==a[1]||t.viewBox[2]!==a[2]||t.viewBox[3]!==a[3];return i}const n=t.rawDims.mediaBox,o=t.rawDims.cropBox,i=Math.abs(n[0]-o[0])>.1||Math.abs(n[1]-o[1])>.1||Math.abs(n[2]-o[2])>.1||Math.abs(n[3]-o[3])>.1;return e.cleanup(),e=null,i})}catch(e){return Promise.reject(e)}}var l=Sejda.LocalStorage.getItem("lastUsedUnits")||"inch";$("input[name=marginTop],input[name=marginLeft],input[name=marginRight],input[name=marginBottom]").on("input",o),$("input[name=pageSizeWidth],input[name=pageSizeHeight]").keyup(o),$(document).on("selectedPagesChanged",function(){o();var e=$(".pdf-page-wrap.selected").length;e?($("#pagesSelectedSome").show(),$("#pagesSelectedAll").hide()):($("#pagesSelectedAll").show(),$("#pagesSelectedSome").hide())}),$(document).on("pagesRendered",o),$(document).on("pdfPageRenderedLazy",function(e,t){var a=$('.pdf-page-wrap[data-file-counter="'+t.file.counter+'"][data-page="'+t.pageNum+'"]');i(a)});var u=$("#pageSize"),g=$("#pageCustomSizeOpts");u.on("changed.bs.select",r);var m=$("#pdf-canvas-wrap"),f=$("#step2Choices").find(".btn[data-choice]");$("#step2ChoicesContinueBtn").click(function(){f.first().click()}),f.click(function(){var e=$(this).attr("data-choice");"add-margins"===e?$("#addMarginsSection").show():"change-page-size"===e?($("#changePageSizeSection").show(),r()):"compress"===e&&(window.location.href="./compress-pdf"),c()}).mouseover(function(){f.removeClass("default")}).mouseout(function(){f.first().addClass("default")}),$(".btn-more-choice-options").click(function(){$(this).fadeOut(100),$(".btn-choice").removeClass("hidden")}),$(document).on("pagesRendered",function(){m.hide()});var h=!1;$(document).on("pdfPageRenderedLazy",function(e,t){p(t.pdf,t.pageNum).then(function(e){if(e){if(h)return;h=!0,$("#flattenCroppedModal").modal("show")}})}),$(document).on("change","[name=unit]",function(){l=this.value,Sejda.LocalStorage.setItem("lastUsedUnits",l),o(),d()}),$('[name=unit][value="'+l+'"]').parents("label").click();const v=$("#tools-menu");$(window).scroll(function(){var e=$(this).scrollTop();e<270?v.css({position:""}).removeClass("fixed"):v.css({position:"fixed",top:0}).addClass("fixed")});const w=$("#globalBtns");w.detach().appendTo(v).show()});