$(function(){function t(t,e,a){t.getPage(e).then(function(t){var i=window.innerWidth-100,o=t.getViewport({scale:1}),c=i/o.width,r=t.getViewport({scale:c}),l=s.find("canvas").get(0),h=l.getContext("2d");l.height=r.height,l.width=r.width,d.css({width:l.width+"px",height:l.height+"px"}),d.attr("data-page-num",e),d.attr("data-scale",c),$("#page-text-selector-header,#page-text-selector-footer").css({width:l.width+"px"});var f={canvasContext:h,viewport:r};h.clearRect(0,0,l.width,l.height);var u=t.render(f);return u.promise.then(function(){s.find("img").attr("src",l.toDataURL()),s.find("canvas").hide(),n(c),a(null,l.toDataURL(),c)},function(t){a(t)})})}function e(){r=void 0;const t=parseFloat(d.attr("data-scale"));n(t),$("#startsWith").val("")}function n(t){c&&c.destroy(),s.find("img").Jcrop({onSelect:function(e){console.log(e),r=e;var n=$("form.task-form:visible");n.find('[name="area[x]"]').val(Math.round(e.x/t)),n.find('[name="area[y]"]').val(Math.round(e.y/t)),n.find('[name="area[width]"]').val(Math.round(e.w/t)),n.find('[name="area[height]"]').val(Math.round(e.h/t))}},function(){c=this})}function a(){c.setSelect([400,100,50,50]),setTimeout(function(){c.release()},1e3)}function i(){r&&setTimeout(function(){c.setSelect([r.x,r.y,r.x2,r.y2])},200)}function o(e){l||(l=!0,PdfFiles.getDocument(e,function(e){$(".doc-loading").hide();var n=1;t(e,n,function(){$("#page-text-selector-wrap").show(),$(".scroll-here-step2:visible").first().scrollHere()}),$(".next-page-btn").click(function(){n>=e.numPages||(n+=1,t(e,n,function(){i()}),$(".prev-page-btn").removeAttr("disabled"),n===e.numPages&&$(this).attr("disabled","disabled"))}),$(".prev-page-btn").click(function(){n<=1||(n-=1,t(e,n,function(){i()}),1===n&&$(this).attr("disabled","disabled"),$(".next-page-btn").removeAttr("disabled"))})}))}var c,r,s=$("#page-text-selector"),d=$(".page-wrap");$(".show-me-how").click(a);var l=!1;$(document).on("filesSelected",function(t,e){o(e.files[0])}),$(document).on("click",".clear-selection-areas-btn",function(){e()})});