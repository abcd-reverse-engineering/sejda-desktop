$(function(){function t(){showAlert("Sorry, scanned documents are not supported.","danger")}function e(t,e,a){t.getPage(e).then(function(t){var i=window.innerWidth-100,r=t.getViewport({scale:1}),o=i/r.width,c=t.getViewport({scale:o}),d=s.find("canvas").get(0),p=d.getContext("2d");d.height=c.height,d.width=c.width,h.css({width:d.width+"px",height:d.height+"px"}),h.attr("data-page-num",e),$("#page-text-selector-header,#page-text-selector-footer").css({width:d.width+"px"});var u={canvasContext:p,viewport:c};p.clearRect(0,0,d.width,d.height);var f=t.render(u);return f.promise.then(function(){s.find("img").attr("src",d.toDataURL()),s.find("canvas").hide(),n(o),a(null,d.toDataURL(),o)},function(t){a(t)})})}function n(t){c&&c.destroy(),s.find("img").Jcrop({onSelect:function(e){console.log(e),i(e,t),c.release()}},function(){c=this})}function a(){f=[],g=0,d.find(".text-area").remove(),u.find("input[name=areas]").val(JSON.stringify(f)),p.val("")}function i(t,e){g++;var n=$('<div class="text-area"></div>'),a="TEXT"+g,i=parseInt(h.attr("data-page-num"));n.attr({id:a,"data-name":a,"data-page-num":i}),n.css({top:t.y+"px",left:t.x+"px",width:t.w+"px",height:t.h+"px"}),d.append(n),f.push({x:Math.round(t.x/e),y:Math.round(t.y/e),width:Math.round(t.w/e),height:Math.round(t.h/e),pageNum:i,name:a}),u.find("input[name=areas]").val(JSON.stringify(f));var r=p.val()||"",o="["+a+"]";r.trim().length>0&&(o="-"+o),p.val(r+o)}function r(){var t=parseInt(h.attr("data-page-num"));d.find(".text-area").each(function(){var e=parseInt($(this).attr("data-page-num"))!==t;e?$(this).hide():$(this).show()})}function o(n){PdfFiles.getDocument(n,function(n){$(".doc-loading").hide();var a=1,i=n.numPages;e(n,a,function(){$("#page-text-selector-wrap").show(),$(".scroll-here-step2:visible").first().scrollHere()}),$(".next-page-btn").click(function(){a+=1,a>i||(e(n,a,r),$(".prev-page-btn").removeAttr("disabled"))}),$(".prev-page-btn").click(function(){a-=1,a<1||e(n,a,r)}),Sejda.PDFJS.checkPageContentsForScan(n).then(function(e){e&&t()})})}var c,s=$("#page-text-selector"),d=$(".areasLayer"),h=$(".page-wrap"),p=$("#renamePattern"),u=$(".task-form"),f=[],g=0;$(document).on("filesSelected",function(t,e){o(e.files[0])}),$(document).on("click",".clear-selection-areas-btn",function(){a()})});